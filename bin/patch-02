#!/usr/bin/env bash
set -ex

# dependencies
(test -z $MCD_DEPLOY) && exit 1
MCD_ADM=0x$(seth call $MCD_DEPLOY 'authority()(address)')

proxy=$(dapp create DSProxy 0xb38cede531c635e7ab5e2303ad2045ca843e110a)
seth send $proxy 'setAuthority(address)' $MCD_ADM
seth send $MCD_DEPLOY 'rely(address)' $proxy

cat > load-mcd-$(seth chain) << EOF
#!/bin/bash

# mcd patch on $(seth chain) from $(git rev-parse HEAD)
# $(date)
export MCD_DEPLOY=$MCD_DEPLOY
export MCD_MOM=$proxy
EOF
